# Claude用設定・プロンプト

このファイルには、AWS MCPを使用したコスト調査のための設定情報とプロンプトテンプレートを記載します。

## AWS MCP設定

### 必要な権限
AWS MCPを使用するために以下のAWS権限が必要です：

- `ce:GetCostAndUsage` - コストと使用量データの取得
- `ce:GetDimensionValues` - ディメンション値の取得
- `ce:GetUsageMetrics` - 使用量メトリクスの取得
- `ce:ListCostCategoryDefinitions` - コストカテゴリ定義の一覧取得
- `pricing:GetProducts` - 料金情報の取得
- `pricing:DescribeServices` - サービス情報の取得

### 環境変数
```bash
export AWS_REGION=us-east-1  # デフォルトリージョン
export AWS_PROFILE=default   # 使用するAWSプロファイル
```

## プロンプトテンプレート

### 基本的なコスト調査プロンプト

```
AWS MCPを使用して以下の条件でコスト調査を行ってください：

**調査期間**: [開始日] から [終了日] まで
**対象リージョン**: [リージョン名]
**対象サービス**: [サービス名]
**フィルタ条件**: CmBillingGroup = "mp" のみ対象

調査内容：
1. 期間中の総コスト
2. 日別・月別のコスト推移
3. サービス別のコスト内訳
4. リソース別の詳細コスト
5. コスト削減の提案

結果は docs/[サービス名].md に保存してください。
```

### 特定リソースの詳細調査プロンプト

```
[サービス名]の詳細コスト分析を行ってください：

**期間**: [YYYY-MM-DD] から [YYYY-MM-DD]
**リージョン**: [リージョン]
**フィルタ条件**: CmBillingGroup = "mp" のみ対象

分析項目：
- インスタンスタイプ別コスト
- 使用時間とコスト効率
- 予約インスタンス vs オンデマンドの比較
- 未使用・低使用率リソースの特定
- 最適化提案（サイジング、料金プラン等）

調査結果をmarkdown形式で整理し、グラフやテーブルを含めて分かりやすく表示してください。
```

### 月次コスト分析プロンプト

```
[YYYY年MM月]の月次AWS コスト分析を実行してください：

**フィルタ条件**: CmBillingGroup = "mp" のみ対象

分析対象：
- 全サービスの月次コスト
- 前月比較（増減率と要因）
- 予算との比較
- 異常なコスト増加の検出
- トップ10コストサービス/リソース

レポート形式：
- エグゼクティブサマリー
- サービス別詳細分析
- アクションアイテム
- 来月の予測とアラート設定提案
```

### コスト最適化提案プロンプト

```
現在のAWS利用状況を分析し、コスト最適化提案を作成してください：

**フィルタ条件**: CmBillingGroup = "mp" のみ対象
分析期間：過去3ヶ月
分析観点：
1. 未使用リソースの特定
2. 過大プロビジョニングの検出
3. 予約インスタンス購入機会
4. スポットインスタンス活用機会
5. ストレージクラス最適化
6. データ転送コスト削減

提案フォーマット：
- 現状の問題点
- 最適化案
- 期待削減効果（金額・割合）
- 実装難易度と期間
- リスク評価
```

## よく使用するコマンド例

### コスト取得の基本形
```
期間: 2024-01-01 から 2024-01-31
サービス: EC2
フィルタ: CmBillingGroup = "mp"
グループ化: インスタンスタイプ別
メトリクス: BlendedCost, UsageQuantity
```

### 異常検知
```
過去30日間で前週比200%以上のコスト増加があったサービスを特定
アラート条件: 日次コストが過去平均の3倍以上
```

## 注意事項

- Cost Explorerデータは通常24-48時間の遅延があります
- 料金は使用リージョンによって異なります
- 為替レートの変動も考慮してください
- 予約インスタンスやスポットインスタンスの料金は別途計算が必要です

## トラブルシューティング

### よくあるエラー
1. **権限不足**: IAMロールに必要な権限が付与されているか確認
2. **リージョン指定**: 正しいリージョンが指定されているか確認
3. **期間指定**: 有効な期間形式(YYYY-MM-DD)で指定されているか確認
4. **API制限**: Cost Explorer APIの制限に引っかかっていないか確認